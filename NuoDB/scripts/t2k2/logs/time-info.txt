==================================== Row #1 ====================================
SQLSTRING: with 
     q_docLen as (select d.id id, sum(v.count) docLen
                 from documents d
                     inner join (vocabulary v)
                     on v.id_document = d.id
                     inner join (documents_authors da
                         inner join (authors a
                             inner join genders g
                             on a.id_gender = g.id)
                         on da.id_author = a.id)
                     on d.id = da.id_document
                 where g.type = 'female'
                 group by d.id),
     q_wordCountDocs as (select v.id_word id_word, count(distinct v.id_document) wordCountDocs
                         from vocabulary v 
                         where v.id_document in (select d.id
                                                     from documents d
                                                     inner join (documents_authors da
                                                         inner join (authors a
                                                             inner join (genders g)
                                                             on a.id_gender = g.id)
                                                         on da.id_author = a.id)
                                                     on d.id = da.id_document
                                                     where g.type = 'female')
                             group by v.id_word),
     q_noDocs as (select d.id id
                     from documents d
                         inner join (documents_authors da
                             inner join (authors a
                                 inner join (genders g)
                                 on a.id_gender = g.id)
                             on da.id_author = a.id)
                         on d.id = da.id_document
                     where g.type = 'female')
 select q2.id id, sum(q2.okapi) sokapi 
         from
             (select d.id id, w.word word, -- v.id_word, v.tf, q_dl.docLen, q_wcd.wordCountDocs,
                     ((v.tf * (1 + (select count(id) from q_noDocs)/q_wcd.wordCountDocs) * (1.6 + 1))/
                     (v.tf + 1.6 * (1 - 0.75 + 0.75 * q_dl.docLen / (select avg(docLen) from q_docLen)))) okapi
             from documents d
                 inner join (vocabulary v
                     inner join (words w) 
                     on w.id = v.id_word)
                 on v.id_document = d.id
                 inner join (documents_authors da
                     inner join (authors a
                         inner join (genders g)
                         on a.id_gender = g.id)
                     on da.id_author = a.id)
                 on d.id = da.id_document
                 inner join q_docLen q_dl
                 on q_dl.id = d.id
                 inner join q_wordCountDocs q_wcd
                 on q_wcd.id_word =  v.id_word
             where g.type = 'female' and w.word in ('think')) q2
         group by q2.id
         order by 2 desc, 1
         limit 10;
COUNT: 1
RUNTIME: 2191309047
USER: DBA
SCHEMA: USER
NUMPARAM: 0
PARAMS: 
NODEID: 2
NROWS: 10
TIMESTAMP: 2024-08-25 15:32:50.293166
EXPLAIN: Project DOCUMENTS.ID, SOKAPI (actual rows: 10, batches: 2)
  Sort SOKAPI DESC D.ID ASC limit 10 (cost: 35454095.1, est. rows: 1, actual rows: 10, total memory: 5KB, peak memory: 5KB, batches: 2)
    Hash grouping keys: D.ID aggregates: SUM(((V.TF * (1 + (COUNT('0') / WORDCOUNTDOCS)) * 2.6) / (V.TF + (1.6 * (2.5e-1 + ((7.5e-1 * DOCLEN) / [AVG])))))) (cost: 35454094.1, est. rows: 1, actual rows: 1712, total memory: 203KB, batches: 55)
      Evaluation ((V.TF * CAST((1 + (COUNT('0') / WORDCOUNTDOCS)) AS double) * 2.6) / (V.TF + CAST((1.6 * (2.5e-1 + ((7.5e-1 * CAST(DOCLEN AS numeric(19,0))) / [AVG]))) AS double))) (actual rows: 1712, batches: 55)
        Nested Loop Join (cost: 35454094.0, est. rows: 0, actual rows: 1712, batches: 55)
          Nested Loop Join (cost: 21382836.7, est. rows: 0, actual rows: 1712, batches: 56)
            ExactlyOneRow (actual rows: 1, batches: 4)
              Streamed aggregation COUNT(*) (cost: 1462267.5, est. rows: 1, actual rows: 1, batches: 1)
                Nested Loop Join (cost: 1212267.5, est. rows: 250000, actual rows: 250247, batches: 7822)
                  Nested Loop Join (cost: 962267.5, est. rows: 250000, actual rows: 250247, batches: 7823)
                    Hash join on (A.ID_GENDER = G.ID) (cost: 712267.5, est. rows: 101743, actual rows: 101761, batches: 3184)
                      Table scan A (AUTHORS) (cost: 610508.0, est. rows: 203486, actual rows: 203486, batches: 6360)
                      Hash (keys: 1, rows: 1, memory: 344B, probe hits: 101761/203486, extracted rows: 101761)
                        Filter (G.TYPE = 'female') (est. rows: 1, actual rows: 1, batches: 2)
                          Table scan G (GENDERS) (cost: 15.5, est. rows: 2, actual rows: 2, batches: 1)
                    Streaming covering record fetch DA (DOCUMENTS_AUTHORS) (cost: 3.0, est. rows: 2, avg. actual rows: 2.5 (total: 250247), batches: 204104)
                      Filter scan DOCUMENTS_AUTHORS..PRIMARY_KEY (ID_AUTHOR[=A.ID] ID_DOCUMENT[] (Last scan ID_AUTHOR[=27384889...] ID_DOCUMENT[])) ASC (avg. actual keys: 2.5 (total: 250247))
                  Streaming covering record fetch D (DOCUMENTS) (shallow) (cost: 1.5, est. rows: 1, avg. actual rows: 1.0 (total: 250247), batches: 500494)
                    Filter scan DOCUMENTS..PRIMARY_KEY (ID[=DA.ID_DOCUMENT] (Last scan ID[=644664924904509440])) ASC (avg. actual keys: 1.0 (total: 250247))
            Nested Loop Join (cost: 16356763.0, est. rows: 0, actual rows: 1712, batches: 55)
              Hash join on (V.ID_DOCUMENT = D.ID) residual ((DA.ID_DOCUMENT = D.ID)) (cost: 16356762.0, est. rows: 0, actual rows: 1712, batches: 56)
                Streamed grouping keys: D.ID aggregates: SUM(V.COUNT) (cost: 7662241.5, est. rows: 500000, actual rows: 250247, batches: 7822)
                  Nested Loop Join (cost: 6522247.0, est. rows: 250000, actual rows: 1135471, batches: 35485)
                    Hash join on (D.ID = DA.ID_DOCUMENT) (cost: 1962269.0, est. rows: 250000, actual rows: 250247, batches: 7823)
                      Streaming covering record fetch D (DOCUMENTS) (cost: 500001.5, est. rows: 500000, actual rows: 500000, batches: 15626)
                        Filter scan DOCUMENTS..PRIMARY_KEY (ID[] (Last scan ID[])) ASC (actual keys: 500000)
                      Hash (keys: 250247, rows: 250247, memory: 11MB, probe hits: 250247/500000, extracted rows: 250247)
                        Nested Loop Join (cost: 962267.5, est. rows: 250000, actual rows: 250247, batches: 7822)
                          Hash join on (A.ID_GENDER = G.ID) (cost: 712267.5, est. rows: 101743, actual rows: 101761, batches: 3183)
                            Table scan A (AUTHORS) (cost: 610508.0, est. rows: 203486, actual rows: 203486, batches: 6360)
                            Hash (keys: 1, rows: 1, memory: 344B, probe hits: 101761/203486, extracted rows: 101761)
                              Filter (G.TYPE = 'female') (est. rows: 1, actual rows: 1, batches: 2)
                                Table scan G (GENDERS) (cost: 15.5, est. rows: 2, actual rows: 2, batches: 1)
                          Streaming covering record fetch DA (DOCUMENTS_AUTHORS) (cost: 3.0, est. rows: 2, avg. actual rows: 2.5 (total: 250247), batches: 204104)
                            Filter scan DOCUMENTS_AUTHORS..PRIMARY_KEY (ID_AUTHOR[=A.ID] ID_DOCUMENT[] (Last scan ID_AUTHOR[=27384889...] ID_DOCUMENT[])) ASC (avg. actual keys: 2.5 (total: 250247))
                    Filter ((D.ID = V.ID_DOCUMENT) AND (V.ID_DOCUMENT = DA.ID_DOCUMENT)) (avg. actual rows: 4.5 (total: 1135471), batches: 500494)
                      Record fetch V (VOCABULARY) (cost: 4.5, est. rows: 1, avg. actual rows: 4.5 (total: 1135471), batches: 250247)
                        Bitmap filter
                          Bitmap scan VOCABULARY..PRIMARY_KEY (ID_DOCUMENT[greatest(=D.ID,=DA.ID_DOCUMENT):least(=D.ID,=DA.ID_DOCUMENT)] ID_WORD[] (Last scan ID_DOCUMENT[=644664926968147968...] ID_WORD[])) (cost: 1.5, est. keys: 1, actual keys: 1135471)
                Hash (keys: 1712, rows: 1712, memory: 106KB, probe hits: 1712/250247, extracted rows: 1712)
                  Hash join on (V.ID_WORD = W.ID) residual ((V.ID_WORD = V.ID_WORD)) (cost: 8444519.5, est. rows: 0, actual rows: 1712, batches: 55)
                    Nested Loop Join (cost: 5522245.5, est. rows: 1139995, actual rows: 1135471, batches: 35485)
                      Nested Loop Join (cost: 962267.5, est. rows: 250000, actual rows: 250247, batches: 7823)
                        Hash join on (A.ID_GENDER = G.ID) (cost: 712267.5, est. rows: 101743, actual rows: 101761, batches: 3184)
                          Table scan A (AUTHORS) (cost: 610508.0, est. rows: 203486, actual rows: 203486, batches: 6360)
                          Hash (keys: 1, rows: 1, memory: 344B, probe hits: 101761/203486, extracted rows: 101761)
                            Filter (G.TYPE = 'female') (est. rows: 1, actual rows: 1, batches: 2)
                              Table scan G (GENDERS) (cost: 15.5, est. rows: 2, actual rows: 2, batches: 1)
                        Streaming covering record fetch DA (DOCUMENTS_AUTHORS) (cost: 3.0, est. rows: 2, avg. actual rows: 2.5 (total: 250247), batches: 204104)
                          Filter scan DOCUMENTS_AUTHORS..PRIMARY_KEY (ID_AUTHOR[=A.ID] ID_DOCUMENT[] (Last scan ID_AUTHOR[=27384889...] ID_DOCUMENT[])) ASC (avg. actual keys: 2.5 (total: 250247))
                      Filter (V.ID_DOCUMENT = DA.ID_DOCUMENT) (avg. actual rows: 4.5 (total: 1135471), batches: 500494)
                        Record fetch V (VOCABULARY) (cost: 18.7, est. rows: 5, avg. actual rows: 4.5 (total: 1135471), batches: 250247)
                          Bitmap filter
                            Bitmap scan VOCABULARY..PRIMARY_KEY (ID_DOCUMENT[=DA.ID_DOCUMENT] ID_WORD[] (Last scan ID_DOCUMENT[=644664924904509440...] ID_WORD[])) (cost: 5.1, est. keys: 5, actual keys: 1135471)
                    Hash (keys: 1, rows: 1, memory: 350B, probe hits: 1712/1135471, extracted rows: 1712)
                      Nested Loop Join (cost: 2352275.8, est. rows: 2, actual rows: 1, batches: 2)
                        Hash grouping keys: V.ID_WORD aggregates: COUNT(distinct V.ID_DOCUMENT) (cost: 2352266.6, est. rows: 2, actual rows: 63911, total memory: 7.1MB, batches: 2000)
                          Right index semi join (cost: 2352262.0, est. rows: 5, actual rows: 1135471, batches: 35485)
                            Nested Loop Join (cost: 1212267.5, est. rows: 250000, actual rows: 250247, batches: 7822)
                              Nested Loop Join (cost: 962267.5, est. rows: 250000, actual rows: 250247, batches: 7823)
                                Hash join on (A.ID_GENDER = G.ID) (cost: 712267.5, est. rows: 101743, actual rows: 101761, batches: 3184)
                                  Table scan A (AUTHORS) (cost: 610508.0, est. rows: 203486, actual rows: 203486, batches: 6360)
                                  Hash (keys: 1, rows: 1, memory: 344B, probe hits: 101761/203486, extracted rows: 101761)
                                    Filter (G.TYPE = 'female') (est. rows: 1, actual rows: 1, batches: 2)
                                      Table scan G (GENDERS) (cost: 15.5, est. rows: 2, actual rows: 2, batches: 1)
                                Streaming covering record fetch DA (DOCUMENTS_AUTHORS) (cost: 3.0, est. rows: 2, avg. actual rows: 2.5 (total: 250247), batches: 204104)
                                  Filter scan DOCUMENTS_AUTHORS..PRIMARY_KEY (ID_AUTHOR[=A.ID] ID_DOCUMENT[] (Last scan ID_AUTHOR[=27384889...] ID_DOCUMENT[])) ASC (avg. actual keys: 2.5 (total: 250247))
                              Streaming covering record fetch D (DOCUMENTS) (cost: 1.5, est. rows: 1, avg. actual rows: 1.0 (total: 250247), batches: 500494)
                                Filter scan DOCUMENTS..PRIMARY_KEY (ID[=DA.ID_DOCUMENT] (Last scan ID[=644664924904509440])) ASC (avg. actual keys: 1.0 (total: 250247))
                            Record fetch V (VOCABULARY) (cost: 18.7, est. rows: 5, actual rows: 1135471, batches: 35485)
                              Bitmap filter
                                Bitmap scan VOCABULARY..PRIMARY_KEY (ID_DOCUMENT[=D.ID] ID_WORD[] (Last scan ID_DOCUMENT[=644664924904509440...] ID_WORD[])) (cost: 5.1, est. keys: 5, actual keys: 1135471)
                        Filter ((W.ID = V.ID_WORD) AND (W.WORD = 'think')) (avg. actual rows: 0.0 (total: 1), batches: 63912)
                          Record fetch W (WORDS) (cost: 4.5, est. rows: 1, avg. actual rows: 1.0 (total: 63911), batches: 127821)
                            Bitmap filter
                              Bitmap scan WORDS..PRIMARY_KEY (ID[=V.ID_WORD] (Last scan ID[=81460])) (cost: 1.5, est. keys: 1, actual keys: 63911)
              Streaming covering record fetch D (DOCUMENTS) (cost: 1.5, est. rows: 1, avg. actual rows: 1.0 (total: 1712), batches: 3424)
                Filter scan DOCUMENTS..PRIMARY_KEY (ID[greatest(=V.ID_DOCUMENT,=DA.ID_DOCUMENT,=D.ID):least(=V.ID_DOCUMENT,=DA.ID_DOCUMENT,=D.ID)] (Last scan ID[=644664904759177216])) ASC (avg. actual keys: 1.0 (total: 1712))
          ExactlyOneRow (avg. actual rows: 1.0 (total: 1712), batches: 3424)
            Evaluation (CAST(SUM(DOCLEN) AS numeric(19,0)) / CAST(COUNT(DOCLEN) AS numeric(19,0))) (avg. actual rows: 1.0 (total: 1712), batches: 1712)
              Streamed aggregation SUM(DOCLEN), COUNT(DOCLEN) (cost: 8162241.5, est. rows: 1, avg. actual rows: 1.0 (total: 1712), batches: 1712)
                Streamed grouping keys: D.ID aggregates: SUM(V.COUNT) (cost: 7662241.5, est. rows: 500000, avg. actual rows: 250247.0 (total: 428422864), batches: 13391264)
                  Nested Loop Join (cost: 6522247.0, est. rows: 250000, avg. actual rows: 1135471.0 (total: 1943926352), batches: 60750320)
                    Hash join on (D.ID = DA.ID_DOCUMENT) (cost: 1962269.0, est. rows: 250000, avg. actual rows: 250247.0 (total: 428422864), batches: 13392976)
                      Streaming covering record fetch D (DOCUMENTS) (cost: 500001.5, est. rows: 500000, avg. actual rows: 500000.0 (total: 856000000), batches: 26751712)
                        Filter scan DOCUMENTS..PRIMARY_KEY (ID[] (Last scan ID[])) ASC (avg. actual keys: 500000.0 (total: 856000000))
                      Hash (build count: 1712, avg. keys: 250247, avg. rows: 250247, avg. memory: 11MB, peak memory: 11MB, probe hits: 428422864/856000000, avg. extracted rows: 250247)
                        Nested Loop Join (cost: 962267.5, est. rows: 250000, avg. actual rows: 250247.0 (total: 428422864), batches: 13391264)
                          Hash join on (A.ID_GENDER = G.ID) (cost: 712267.5, est. rows: 101743, avg. actual rows: 101761.0 (total: 174214832), batches: 5449296)
                            Table scan A (AUTHORS) (cost: 610508.0, est. rows: 203486, avg. actual rows: 203486.0 (total: 348368032), batches: 10888320)
                            Hash (build count: 1712, avg. keys: 1, avg. rows: 1, avg. memory: 344B, peak memory: 344B, probe hits: 174214832/348368032, avg. extracted rows: 101761)
                              Filter (G.TYPE = 'female') (est. rows: 1, avg. actual rows: 1.0 (total: 1712), batches: 3424)
                                Table scan G (GENDERS) (cost: 15.5, est. rows: 2, avg. actual rows: 2.0 (total: 3424), batches: 1712)
                          Streaming covering record fetch DA (DOCUMENTS_AUTHORS) (cost: 3.0, est. rows: 2, avg. actual rows: 2.5 (total: 428422864), batches: 349426048)
                            Filter scan DOCUMENTS_AUTHORS..PRIMARY_KEY (ID_AUTHOR[=A.ID] ID_DOCUMENT[] (Last scan ID_AUTHOR[=27384889...] ID_DOCUMENT[])) ASC (avg. actual keys: 2.5 (total: 428422864))
                    Filter ((D.ID = V.ID_DOCUMENT) AND (V.ID_DOCUMENT = DA.ID_DOCUMENT)) (avg. actual rows: 4.5 (total: 1943926352), batches: 856845728)
                      Record fetch V (VOCABULARY) (cost: 4.5, est. rows: 1, avg. actual rows: 4.5 (total: 1943926352), batches: 428422864)
                        Bitmap filter
                          Bitmap scan VOCABULARY..PRIMARY_KEY (ID_DOCUMENT[greatest(=D.ID,=DA.ID_DOCUMENT):least(=D.ID,=DA.ID_DOCUMENT)] ID_WORD[] (Last scan ID_DOCUMENT[=644664926968147968...] ID_WORD[])) (cost: 1.5, est. keys: 1, actual keys: 1943926352)
